# Hooksé…ç½®æ–‡ä»¶
# å®šä¹‰é¡¹ç›®ç”Ÿå‘½å‘¨æœŸä¸­çš„è‡ªåŠ¨åŒ–è§¦å‘ç‚¹å’Œå“åº”åŠ¨ä½œ

hooks:
  # ================================
  # Git Hooks (ä»£ç ç‰ˆæœ¬æ§åˆ¶)
  # ================================
  
  git_hooks:
    pre-commit:
      description: "ä»£ç æäº¤å‰æ£€æŸ¥"
      trigger: "git commitæ‰§è¡Œå‰"
      agents: ["QA Agent", "Security Agent", "Architect Agent"]
      actions:
        - name: "code_quality_check"
          command: "/code-review staged --focus all --automated"
          timeout: 300
          failure_action: "block_commit"
          
        - name: "security_scan"
          command: "/security-scan --quick --staged"
          timeout: 180
          failure_action: "warn_and_continue"
          
        - name: "test_run"
          command: "/test-run unit affected --parallel"
          timeout: 600
          failure_action: "block_commit"
          
        - name: "spec_validation"
          command: "/validate-spec --against-code"
          timeout: 120
          failure_action: "warn_and_continue"
      
      conditions:
        - "æœ‰ä»£ç æ–‡ä»¶å˜æ›´"
        - "ä¸åœ¨hotfixåˆ†æ”¯"
      
      notifications:
        success: "æäº¤å‰æ£€æŸ¥é€šè¿‡ âœ…"
        failure: "æäº¤å‰æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤åé‡è¯• âŒ"

    pre-push:
      description: "ä»£ç æ¨é€å‰æ£€æŸ¥"
      trigger: "git pushæ‰§è¡Œå‰"
      agents: ["DevOps Agent", "QA Agent"]
      actions:
        - name: "integration_test"
          command: "/test-run integration current-branch --coverage"
          timeout: 1200
          failure_action: "block_push"
          
        - name: "build_verification"
          command: "/build --verify --target staging"
          timeout: 900
          failure_action: "block_push"
          
        - name: "dependency_check"
          command: "/security-scan --dependencies --critical-only"
          timeout: 300
          failure_action: "block_push"
      
      conditions:
        - "æ¨é€åˆ°ä¸»è¦åˆ†æ”¯(main/develop)"
        - "åŒ…å«æ–°çš„åŠŸèƒ½ä»£ç "
      
      notifications:
        success: "æ¨é€å‰æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥æ¨é€ ğŸš€"
        failure: "æ¨é€å‰æ£€æŸ¥å¤±è´¥ï¼Œæ¨é€è¢«é˜»æ­¢ ğŸš«"

    post-merge:
      description: "ä»£ç åˆå¹¶åå¤„ç†"
      trigger: "Pull Requeståˆå¹¶å"
      agents: ["DevOps Agent", "PM Agent"]
      actions:
        - name: "deploy_to_dev"
          command: "/deploy-prep development auto --validate"
          timeout: 1800
          failure_action: "notify_team"
          
        - name: "update_progress"
          command: "/progress-sync --auto-update"
          timeout: 60
          failure_action: "log_only"
          
        - name: "notify_stakeholders"
          command: "/notify --type merge-completed --stakeholders auto"
          timeout: 30
          failure_action: "log_only"
      
      async: true
      notifications:
        success: "åˆå¹¶åå¤„ç†å®Œæˆ âœ…"
        failure: "åˆå¹¶åå¤„ç†å¤±è´¥ï¼Œè¯·æ£€æŸ¥ âš ï¸"

  # ================================
  # Project Lifecycle Hooks (é¡¹ç›®ç”Ÿå‘½å‘¨æœŸ)
  # ================================
  
  project_hooks:
    on_milestone_reach:
      description: "é‡Œç¨‹ç¢‘è¾¾æˆæ£€æŸ¥"
      trigger: "é‡Œç¨‹ç¢‘è¾¾æˆæ—¶"
      agents: ["PM Agent", "QA Agent", "Architect Agent"]
      actions:
        - name: "quality_gate_check"
          command: "/quality-report milestone current --comprehensive"
          timeout: 300
          failure_action: "escalate"
          
        - name: "progress_report"
          command: "/progress-sync --milestone --detailed"
          timeout: 180
          failure_action: "manual_fallback"
          
        - name: "risk_assessment"
          command: "/analyze --scope project --focus risks"
          timeout: 240
          failure_action: "manual_fallback"
          
        - name: "stakeholder_notification"
          command: "/notify --type milestone --all-stakeholders"
          timeout: 60
          failure_action: "retry_later"
      
      conditions:
        - "é‡Œç¨‹ç¢‘ä»»åŠ¡å®Œæˆåº¦ >= 95%"
        - "è´¨é‡æŒ‡æ ‡è¾¾æ ‡"
      
      notifications:
        success: "ğŸ‰ é‡Œç¨‹ç¢‘è¾¾æˆï¼è´¨é‡æ£€æŸ¥é€šè¿‡"
        failure: "âš ï¸ é‡Œç¨‹ç¢‘æ£€æŸ¥å‘ç°é—®é¢˜ï¼Œéœ€è¦å…³æ³¨"

    on_deadline_approach:
      description: "æˆªæ­¢æ—¥æœŸä¸´è¿‘å¤„ç†"
      trigger: "è·ç¦»æˆªæ­¢æ—¥æœŸ48å°æ—¶å†…"
      agents: ["PM Agent", "Architect Agent"]
      actions:
        - name: "risk_assessment"
          command: "/analyze --scope remaining-tasks --focus time-risk"
          timeout: 300
          failure_action: "manual_fallback"
          
        - name: "resource_rebalance"
          command: "/task-break remaining --focus critical-path"
          timeout: 240
          failure_action: "manual_fallback"
          
        - name: "scope_adjustment"
          command: "/prd-gen --scope-review --priority-rebalance"
          timeout: 180
          failure_action: "escalate"
          
        - name: "team_notification"
          command: "/notify --type deadline-warning --all-team"
          timeout: 30
          failure_action: "retry_later"
      
      frequency: "daily"
      notifications:
        success: "æˆªæ­¢æ—¥æœŸé£é™©è¯„ä¼°å®Œæˆ"
        failure: "æˆªæ­¢æ—¥æœŸé£é™©è¯„ä¼°å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥"

    on_bug_critical:
      description: "ä¸¥é‡ç¼ºé™·å“åº”"
      trigger: "å‘ç°Criticalçº§åˆ«ç¼ºé™·"
      agents: ["PM Agent", "QA Agent", "Senior Engineer Agent"]
      actions:
        - name: "emergency_response"
          command: "/analyze --scope bug-impact --urgent"
          timeout: 300
          failure_action: "escalate_immediately"
          
        - name: "hotfix_plan"
          command: "/task-break hotfix --emergency --timeline"
          timeout: 240
          failure_action: "manual_fallback"
          
        - name: "team_mobilization"
          command: "/notify --type emergency --priority critical"
          timeout: 30
          failure_action: "manual_fallback"
          
        - name: "stakeholder_alert"
          command: "/notify --type critical-bug --stakeholders emergency"
          timeout: 60
          failure_action: "escalate"
      
      immediate: true
      notifications:
        success: "ğŸš¨ ä¸¥é‡ç¼ºé™·å“åº”æµç¨‹å¯åŠ¨"
        failure: "âŒ ä¸¥é‡ç¼ºé™·å“åº”å¤±è´¥ï¼Œç«‹å³äººå·¥ä»‹å…¥"

  # ================================
  # Development Hooks (å¼€å‘æµç¨‹)
  # ================================
  
  development_hooks:
    on_feature_start:
      description: "åŠŸèƒ½å¼€å‘å¼€å§‹"
      trigger: "åˆ›å»ºfeatureåˆ†æ”¯æ—¶"
      agents: ["PM Agent", "Architect Agent"]
      actions:
        - name: "spec_validation"
          command: "/spec-create feature --validate-requirements"
          timeout: 300
          failure_action: "warn_and_continue"
          
        - name: "task_breakdown"
          command: "/task-break feature --detailed --estimates"
          timeout: 240
          failure_action: "manual_fallback"
          
        - name: "test_planning"
          command: "/test-gen plan feature --coverage-target 80%"
          timeout: 180
          failure_action: "warn_and_continue"
      
      conditions:
        - "åˆ†æ”¯ååŒ…å«'feature/'"
        - "æœ‰å…³è”çš„éœ€æ±‚æ–‡æ¡£"
      
      notifications:
        success: "åŠŸèƒ½å¼€å‘å‡†å¤‡å°±ç»ª ğŸš€"
        failure: "åŠŸèƒ½å¼€å‘å‡†å¤‡æ£€æŸ¥å¤±è´¥ âš ï¸"

    on_code_change:
      description: "ä»£ç å˜æ›´æ£€æŸ¥"
      trigger: "ä»£ç æ–‡ä»¶å˜æ›´æ—¶"
      agents: ["Architect Agent", "Security Agent"]
      actions:
        - name: "architecture_impact"
          command: "/code-review diff --focus architecture"
          timeout: 120
          failure_action: "warn_and_continue"
          
        - name: "security_quick_scan"
          command: "/security-scan --quick --diff"
          timeout: 90
          failure_action: "warn_and_continue"
          
        - name: "performance_impact"
          command: "/analyze --scope performance-impact --quick"
          timeout: 60
          failure_action: "log_only"
      
      debounce: 30  # 30ç§’å†…çš„å¤šæ¬¡å˜æ›´åˆå¹¶å¤„ç†
      conditions:
        - "å˜æ›´è¡Œæ•° > 10"
        - "æ¶‰åŠæ ¸å¿ƒæ¨¡å—"

    on_test_failure:
      description: "æµ‹è¯•å¤±è´¥å¤„ç†"
      trigger: "è‡ªåŠ¨åŒ–æµ‹è¯•å¤±è´¥æ—¶"
      agents: ["QA Agent", "Developer Agent"]
      actions:
        - name: "failure_analysis"
          command: "/analyze --scope test-failure --detailed"
          timeout: 300
          failure_action: "manual_fallback"
          
        - name: "impact_assessment"
          command: "/test-run --analyze-impact failed-tests"
          timeout: 180
          failure_action: "manual_fallback"
          
        - name: "auto_retry"
          command: "/test-run failed-tests --retry-flaky"
          timeout: 600
          failure_action: "escalate"
      
      retry_limit: 2
      notifications:
        success: "æµ‹è¯•å¤±è´¥åˆ†æå®Œæˆ"
        failure: "æµ‹è¯•å¤±è´¥åˆ†æå¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥"

  # ================================
  # Deployment Hooks (éƒ¨ç½²æµç¨‹)
  # ================================
  
  deployment_hooks:
    on_deploy_start:
      description: "éƒ¨ç½²å¼€å§‹æ£€æŸ¥"
      trigger: "éƒ¨ç½²æµç¨‹å¯åŠ¨æ—¶"
      agents: ["DevOps Agent", "QA Agent"]
      actions:
        - name: "pre_deploy_validation"
          command: "/deploy-prep --validate --comprehensive"
          timeout: 600
          failure_action: "block_deployment"
          
        - name: "health_check_baseline"
          command: "/monitor-setup --baseline --pre-deploy"
          timeout: 180
          failure_action: "warn_and_continue"
          
        - name: "rollback_preparation"
          command: "/deploy-prep --rollback-plan --verify"
          timeout: 300
          failure_action: "block_deployment"
      
      conditions:
        - "ç›®æ ‡ç¯å¢ƒä¸ºstagingæˆ–production"
        - "é€šè¿‡æ‰€æœ‰è´¨é‡é—¨ç¦"
      
      notifications:
        success: "éƒ¨ç½²å‰æ£€æŸ¥é€šè¿‡ï¼Œå¼€å§‹éƒ¨ç½² ğŸš€"
        failure: "éƒ¨ç½²å‰æ£€æŸ¥å¤±è´¥ï¼Œéƒ¨ç½²è¢«é˜»æ­¢ ğŸš«"

    on_deploy_success:
      description: "éƒ¨ç½²æˆåŠŸåéªŒè¯"
      trigger: "éƒ¨ç½²æˆåŠŸå®Œæˆæ—¶"
      agents: ["DevOps Agent", "QA Agent"]
      actions:
        - name: "health_verification"
          command: "/test-run smoke production --critical-only"
          timeout: 900
          failure_action: "trigger_rollback"
          
        - name: "performance_baseline"
          command: "/monitor-setup --post-deploy --compare-baseline"
          timeout: 300
          failure_action: "alert_team"
          
        - name: "notification"
          command: "/notify --type deploy-success --environment production"
          timeout: 60
          failure_action: "log_only"
      
      delay: 300  # ç­‰å¾…5åˆ†é’Ÿè®©ç³»ç»Ÿç¨³å®š
      notifications:
        success: "âœ… éƒ¨ç½²æˆåŠŸä¸”éªŒè¯é€šè¿‡"
        failure: "âš ï¸ éƒ¨ç½²æˆåŠŸä½†éªŒè¯å¤±è´¥"

    on_deploy_failure:
      description: "éƒ¨ç½²å¤±è´¥å¤„ç†"
      trigger: "éƒ¨ç½²å¤±è´¥æ—¶"
      agents: ["DevOps Agent", "PM Agent"]
      actions:
        - name: "auto_rollback"
          command: "/deploy --rollback --immediate"
          timeout: 600
          failure_action: "manual_intervention"
          
        - name: "incident_creation"
          command: "/incident --create --severity high --type deployment"
          timeout: 120
          failure_action: "manual_fallback"
          
        - name: "team_notification"
          command: "/notify --type deploy-failure --priority urgent"
          timeout: 30
          failure_action: "escalate"
      
      immediate: true
      notifications:
        success: "éƒ¨ç½²å¤±è´¥å¤„ç†æµç¨‹å®Œæˆ"
        failure: "éƒ¨ç½²å¤±è´¥å¤„ç†å¤±è´¥ï¼Œéœ€è¦ç«‹å³äººå·¥ä»‹å…¥"

  # ================================
  # Monitoring Hooks (ç›‘æ§å‘Šè­¦)
  # ================================
  
  monitoring_hooks:
    on_performance_degradation:
      description: "æ€§èƒ½ä¸‹é™å“åº”"
      trigger: "æ€§èƒ½æŒ‡æ ‡ä¸‹é™è¶…è¿‡é˜ˆå€¼"
      agents: ["Performance Agent", "DevOps Agent"]
      actions:
        - name: "performance_analysis"
          command: "/analyze --scope performance --urgent"
          timeout: 300
          failure_action: "escalate"
          
        - name: "auto_scaling_check"
          command: "/deploy --check-scaling --auto-adjust"
          timeout: 180
          failure_action: "manual_fallback"
          
        - name: "alert_team"
          command: "/notify --type performance-issue --priority high"
          timeout: 30
          failure_action: "retry_later"
      
      cooldown: 900  # 15åˆ†é’Ÿå†·å´æœŸ
      thresholds:
        response_time: ">500ms"
        error_rate: ">1%"
        cpu_usage: ">80%"

    on_security_alert:
      description: "å®‰å…¨å‘Šè­¦å“åº”"
      trigger: "æ£€æµ‹åˆ°å®‰å…¨å¨èƒ"
      agents: ["Security Agent", "DevOps Agent"]
      actions:
        - name: "threat_analysis"
          command: "/security-scan --comprehensive --urgent"
          timeout: 600
          failure_action: "escalate_immediately"
          
        - name: "incident_response"
          command: "/incident --create --severity critical --type security"
          timeout: 120
          failure_action: "manual_intervention"
          
        - name: "emergency_notification"
          command: "/notify --type security-threat --priority critical"
          timeout: 30
          failure_action: "escalate"
      
      immediate: true
      notifications:
        success: "ğŸ”’ å®‰å…¨å¨èƒå“åº”æµç¨‹å¯åŠ¨"
        failure: "âŒ å®‰å…¨å¨èƒå“åº”å¤±è´¥ï¼Œç«‹å³å‡çº§å¤„ç†"

# ================================
# Hook Configuration
# ================================

hook_config:
  # å…¨å±€è®¾ç½®
  global:
    timeout_default: 300  # é»˜è®¤è¶…æ—¶æ—¶é—´(ç§’)
    retry_attempts: 3     # é»˜è®¤é‡è¯•æ¬¡æ•°
    parallel_execution: true  # æ”¯æŒå¹¶è¡Œæ‰§è¡Œ
    log_level: "info"     # æ—¥å¿—çº§åˆ«
    
  # é€šçŸ¥é…ç½®
  notifications:
    channels:
      slack: "#dev-team"
      email: "team@company.com"
      webhook: "https://hooks.company.com/webhook"
    
    templates:
      success: "âœ… {hook_name} æ‰§è¡ŒæˆåŠŸ"
      failure: "âŒ {hook_name} æ‰§è¡Œå¤±è´¥: {error}"
      warning: "âš ï¸ {hook_name} æ‰§è¡Œå®Œæˆä½†æœ‰è­¦å‘Š"
  
  # é”™è¯¯å¤„ç†
  error_handling:
    escalation_levels:
      - "team_lead"
      - "project_manager"
      - "technical_director"
    
    failure_actions:
      block_commit: "é˜»æ­¢ä»£ç æäº¤"
      block_push: "é˜»æ­¢ä»£ç æ¨é€"
      block_deployment: "é˜»æ­¢éƒ¨ç½²"
      trigger_rollback: "è§¦å‘è‡ªåŠ¨å›æ»š"
      escalate: "å‡çº§åˆ°ä¸Šçº§å¤„ç†"
      manual_intervention: "éœ€è¦äººå·¥å¹²é¢„"
      retry_later: "ç¨åé‡è¯•"
      log_only: "ä»…è®°å½•æ—¥å¿—"
  
  # æ‰§è¡Œç¯å¢ƒ
  execution:
    max_concurrent_hooks: 10
    hook_isolation: true
    resource_limits:
      cpu: "2 cores"
      memory: "4GB"
      timeout: "30 minutes"